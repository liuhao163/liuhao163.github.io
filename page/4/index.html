<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="励志当好厨子的程序员">
<meta property="og:type" content="website">
<meta property="og:title" content="liuhao163.github.io">
<meta property="og:url" content="https://liuhao163.github.io/page/4/index.html">
<meta property="og:site_name" content="liuhao163.github.io">
<meta property="og:description" content="励志当好厨子的程序员">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="liuhao163.github.io">
<meta name="twitter:description" content="励志当好厨子的程序员">



  <link rel="alternate" href="/atom.xml" title="liuhao163.github.io" type="application/atom+xml">




  <link rel="canonical" href="https://liuhao163.github.io/page/4/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>liuhao163.github.io – 杂七杂八</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">liuhao163.github.io</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">杂七杂八</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>Sitemap</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/共享服务中心的建设之路/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/共享服务中心的建设之路/" class="post-title-link" itemprop="url">共享服务中心的建设之路</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-24 13:46:22" itemprop="dateCreated datePublished" datetime="2020-06-24T13:46:22Z">2020-06-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/" itemprop="url" rel="index"><span itemprop="name">读后感</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/企业IT架构转型之道/" itemprop="url" rel="index"><span itemprop="name">企业IT架构转型之道</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Why-amp-amp-When-为什么什么时候要建立共享服务中心"><a href="#Why-amp-amp-When-为什么什么时候要建立共享服务中心" class="headerlink" title="Why &amp;&amp; When 为什么什么时候要建立共享服务中心"></a>Why &amp;&amp; When 为什么什么时候要建立共享服务中心</h2><p>业务发展到一定阶段，之前的服务都散落在各自的业务领域，那么对于使用者来说这种野蛮发展带来了如下的问题：</p>
<ol>
<li>服务数量多业务范围涵盖越来越广，如何快速的找到服务成为了要解决的问题</li>
<li>应用和架构越分越细，服务越来越专业化，学习成本变高</li>
<li>服务缺乏缺乏统一的管控，往往会出现不知道这些服务又哪些下游，是如何调用，自己随意发布版本导致服务不稳定；<ol>
<li>防止恶意调用</li>
<li>防止认为的错误调用</li>
<li>管理服务的依赖关系，提供统一的SLA协议规范</li>
</ol>
</li>
<li>缺少治理层：之前服务的标准，接入方式，鉴权方式散落在各个角落（wiki、文档、开发人员的大脑），需要一个平台对服务进行收敛，减少接入成本；</li>
</ol>
<h2 id="What-共享服务中心（SPAS-是做什么用的职责是什么"><a href="#What-共享服务中心（SPAS-是做什么用的职责是什么" class="headerlink" title="What 共享服务中心（SPAS)是做什么用的职责是什么"></a>What 共享服务中心（SPAS)是做什么用的职责是什么</h2><p>它的主要职责是将一个个的服务封装成服务组件为服务消费者提供服务的平台，为服务提供者提供统一的服务治理，为服务的消费者降低接入成本，提供更稳定的服务</p>
<p>建设思路：</p>
<ol>
<li>找到服务化的对象</li>
<li>提供服务化基础设施</li>
<li>服务下沉为共享服务中心的组件（实施 由服务提供者接入）</li>
<li>增强服务和基础设施实现服务治理（提供服务鉴权、运营报表、运维工具等）</li>
</ol>
<p>阿里巴巴的实现思路</p>
<ol>
<li>服务化对象是API：面向API，将API封装成服务（通用）</li>
<li>提供服务化基础设施【有借鉴意义】<ol>
<li>服务描述的元信息</li>
<li>服务注册发现机制（该服务有一个统一的服务发现平台，比如mq的订阅管控关系， hsf的注册中心等）</li>
<li>服务的访问控制和安全策略</li>
<li>应用服务的Protal</li>
<li>服务的依赖管理和运维管理</li>
<li>服务的SLA协议</li>
<li>消费者管理工具与支持工具</li>
<li>服务化辅助工具支持</li>
<li>服务化的报表与分析工具</li>
</ol>
</li>
<li>服务化实施阶段：<ol>
<li>API as Service</li>
<li>Product as Service</li>
<li>Solution as Service</li>
</ol>
</li>
</ol>
<h3 id="How-如何协作"><a href="#How-如何协作" class="headerlink" title="How 如何协作"></a>How 如何协作</h3><ul>
<li>共享服务中心：提供服务的治理能力以及相关基础设施，指导服务的接入</li>
<li>服务提供者：服务将服务接入到共享中心，管理服务，提供场景化解决方案</li>
<li>服务消费者：接入服务，按照规范使用服务，并且给于服务反馈</li>
</ul>
<p>共享服务中心和前端（前端事业部）</p>
<ol>
<li>和前端核心业务简历紧密沟通机制，积极参加这些部门的技术需求会议，及时响应</li>
<li>分歧上升机制：遇到分歧，采取层层上升机制</li>
<li>轮岗制度：保证换位思考</li>
<li>共享服务中心的发展方式，当发现一些服务存在于不同的前端，可以尝试集成、沉淀到共享服务中心<ol>
<li>共享服务中心的架构师或者RD有独自沉淀能力，和业务方沟通自己实施；</li>
<li>共享服务中心的架构师暂时没有能力，采用共建的方式，业务方和共享服务中心的人员一起实施保障快速落地，同时也能在参与工程中培养这方面的技术能力。</li>
</ol>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/企业的稳定性建设/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/企业的稳定性建设/" class="post-title-link" itemprop="url">企业的稳定性建设</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-23 19:53:36" itemprop="dateCreated datePublished" datetime="2020-06-23T19:53:36Z">2020-06-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/" itemprop="url" rel="index"><span itemprop="name">读后感</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/企业IT架构转型之道/" itemprop="url" rel="index"><span itemprop="name">企业IT架构转型之道</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="限流和降级"><a href="#限流和降级" class="headerlink" title="限流和降级"></a>限流和降级</h2><p>  见<a href="https://liuhao163.github.io/%E7%A8%B3%E5%AE%9A%E6%80%A7%E8%AE%A8%E8%AE%BA/">稳定性看法</a></p>
<p>  接入层可以在nginx层做，服务层阿里采用的sentinal，相比开源出来的jar包，它是个集成了hsf，集策略配置，下发于一体的限流、降级管控平台。</p>
<h2 id="流量调度平台"><a href="#流量调度平台" class="headerlink" title="流量调度平台"></a>流量调度平台</h2><p>  有些系统由于发布、网络抖动、故障等原因会导致服务中某个节点出现负载升高，导致高节点响应时间变长，请求排队等情况，进一步可能威胁到上下游的稳定性。</p>
<p>  相比于上面提到的限流和降级，这种流量调度平台更专注解决服务某一个节点的问题。</p>
<p>  实现原理</p>
<blockquote>
<ol>
<li>采集系统+业务指标</li>
<li>通过一定时间维度的指标和故障模型匹配</li>
<li>后续故障处置：降权（hsf的服务权重）、摘除（踢掉节点）。</li>
</ol>
</blockquote>
<h2 id="开关服务"><a href="#开关服务" class="headerlink" title="开关服务"></a>开关服务</h2><p>  感觉很像spring-cloud全家桶中的config服务的作用，用来下发开关</p>
<h2 id="容量压测和容量评估"><a href="#容量压测和容量评估" class="headerlink" title="容量压测和容量评估"></a>容量压测和容量评估</h2><ol>
<li>线上流量引入，测试单机的qps，得到单机服务的性能基线</li>
<li>根据单机qps来评估集群容量，在双11大促等场景对服务承载能力掌控更精准，节省服务器资源</li>
</ol>
<h2 id="全链路压测"><a href="#全链路压测" class="headerlink" title="全链路压测"></a>全链路压测</h2><p>  ！很重要，也是阿里的法宝之一，方法论如下：</p>
<ol>
<li>基础数据抽取：对现有的生产数据进行筛选、过滤、抽取</li>
<li>链路模型构造：构造压测链路的模型</li>
<li>链路验证：对模型进行验证</li>
<li>业务改造：业务对于压测的幂等支持，放线上数据污染能</li>
<li>数据平台：全链路压测的数据极地</li>
<li>流量平台：操控中心（对压测进行限制，配置），压测引擎（部署在外网cdn中）</li>
<li>中间件支持：压测标志支持，数据隔离跟踪等。</li>
<li>影子表：通过设置影子表将压测数据录入到影子表方变后续管理</li>
<li>安全策略支持：对压测数据的识别，不要误认为攻击，对于压测数据的监控防止恶意模仿</li>
</ol>
<h2 id="业务数据一致性"><a href="#业务数据一致性" class="headerlink" title="业务数据一致性"></a>业务数据一致性</h2><p>  阿里内部将BCP(bussiness check platform)，为了不影响业务，是通过时间触发的原理实现。</p>
<p>  即。感知数据的变化（精卫、mq）之后根据配置的事件类型找到检测模型，进行规则校验，然后结果入库，发现异常发送报警通知。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/服务管控-分布式服务全链路跟踪和分析系统/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/服务管控-分布式服务全链路跟踪和分析系统/" class="post-title-link" itemprop="url">服务管控-分布式服务全链路跟踪和分析系统</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-22 21:32:08" itemprop="dateCreated datePublished" datetime="2020-06-22T21:32:08Z">2020-06-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/" itemprop="url" rel="index"><span itemprop="name">读后感</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/企业IT架构转型之道/" itemprop="url" rel="index"><span itemprop="name">企业IT架构转型之道</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>系统服务化或者后续的微服务架构，做到了服务隔离，业务解耦，在带来这些便利的同时也回答带来了排查错误不好定位的问题，因为一个请求往往横跨多个服务。还有异步化等等。<br>所以一套好用的满足分布式系统的全链路跟踪分析系统可以说是整个服务化最重要的基础组件。</p>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><p>俩部分，日志采集，和日志分析</p>
<h3 id="日志采集"><a href="#日志采集" class="headerlink" title="日志采集"></a>日志采集</h3><ul>
<li>采集：业务几乎无感，业务服务只需要向自身所在的服务器写本地log，服务器有一个采集日志的agent，根据采集中心的配置去制定的目录下实时同步log给日志处理中心。</li>
<li>处理：通过storm spark flink将日志进行清洗，实时的我们可以打到hbase和es中。离线的我们可以存到hadoop中</li>
<li>日志格式：全局的TraceID（本次调用的全局ID）+RpcID(本次调用中该节点的ID,建议是有顺序的支持嵌套调用比如1，1.1，1.1.1)+时间戳+数据标签（分类）+业务组件+msg</li>
<li>采集管控：业务高峰可能产生很多log我们对于一段时间内相同的log要进行降频控制防止对业务有影响</li>
</ul>
<h3 id="常用组件"><a href="#常用组件" class="headerlink" title="常用组件"></a>常用组件</h3><ul>
<li>agent开发（java、go）</li>
<li>数据通道kafka，rocktmq</li>
<li>日志清洗spark，flink，strom</li>
<li>数据存储es，hbase，hadoop</li>
</ul>
<h2 id="具体应用场景"><a href="#具体应用场景" class="headerlink" title="具体应用场景"></a>具体应用场景</h2><ul>
<li>监控业务：原始的监控服务器指标已经不满足服务化的需求了，因为有可能服务指标良好，但是服务已经不可用了，我们可以通过这台全链路的跟踪系统通过自己埋点构建有个性的监控系统</li>
<li>实时全链路排查：加强业务的管控，实时的了解业务调用链路的异常出在哪里，快速排错，进行有针对性的优化</li>
<li>离线的全链路分析：针对业务架构师，可以分析一段时间内接口调用情况，查看一个接口整体的设计。比如：依赖是否和合理，强依赖是否平均耗时较高，若依赖是否可以异步化等，使我们服务的编排更合理，架构更加贴近业务。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/异步化于缓存原则/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/异步化于缓存原则/" class="post-title-link" itemprop="url">异步化与缓存原则</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-21 09:22:57" itemprop="dateCreated datePublished" datetime="2020-06-21T09:22:57Z">2020-06-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/" itemprop="url" rel="index"><span itemprop="name">读后感</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/企业IT架构转型之道/" itemprop="url" rel="index"><span itemprop="name">企业IT架构转型之道</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="接口异步"><a href="#接口异步" class="headerlink" title="接口异步"></a>接口异步</h2><p>当业务打到一定规模后，接口串行是性能的一大杀手，因为它：</p>
<ul>
<li>影响用户体验：一个接口往往会至少调用3~5个甚至更多的服务，对于用户的访问会有极大的延迟。</li>
<li>降低系统吞吐：比如一个大的事务或者请求往往会长时间占用链接当业务高峰来了后会占用很多链接无法释放，导致请求排队。</li>
</ul>
<p>接口的异步化往往是解决这种问题的利器，我们可以使用一些带有顺序消费能力的消息队列来解决这种问题。我们实际开发中往往是将一个大事务通过MQ等手段异步拆成多个小事务来增大并发。</p>
<h2 id="分布式事务的数据一致性"><a href="#分布式事务的数据一致性" class="headerlink" title="分布式事务的数据一致性"></a>分布式事务的数据一致性</h2><p>  分布式服务必然会带来数据一致性的问题，和事务的CAID相比，基本遵循俩个原则</p>
<h3 id="CAP理论"><a href="#CAP理论" class="headerlink" title="CAP理论"></a>CAP理论</h3><p>C:一致性<br>A:高可用性<br>P:发生故障好，保证分区可用</p>
<p>分布式事务往往无法完全严格实现CAP，一般是保证P的基础上实现C、A。</p>
<h3 id="BASE理论"><a href="#BASE理论" class="headerlink" title="BASE理论"></a>BASE理论</h3><p>是CAP的一种延展</p>
<p>BA：基本可用，对应的是降级<br>S：柔性状态，即允许当前数据存在中间状态，比如mysql同步时候各从库的数据可能不一致<br>E：最终一致性，即一段时间之后数据会达成最终一致</p>
<h3 id="俩阶段提交"><a href="#俩阶段提交" class="headerlink" title="俩阶段提交"></a>俩阶段提交</h3><p>  原始的分布式事务采用XA俩阶段提交。分为俩个接口：</p>
<ul>
<li>XT：客户端–&gt;事务管理器，负责开始事务、提交事务、回滚事务</li>
<li><p>XA：一般是资源管理器和事务之间交互，比如回滚，提交等。</p>
<p>在这个协议下整个事务的流程是这样的：</p>
<ol>
<li>客户端开启事务;</li>
<li>客户端操作事务中多个资源管理器（mysql）这时候数据已经持久化</li>
<li>客户端提交事务<ol>
<li>第一阶段：prepare，事务管理器去轮询各资源管理器检查状态，返回 READY,NOT_READY,READY_ONLY，</li>
<li>第二阶段：commit or rollback，根据第一节阶段的结果进行rollbacck（NOT_READY）或者commit（READY）。</li>
</ol>
</li>
</ol>
</li>
</ul>
<h3 id="分布式系统–柔性事务"><a href="#分布式系统–柔性事务" class="headerlink" title="分布式系统–柔性事务"></a>分布式系统–柔性事务</h3><p>  上面的方案在传统项目中是可以的，但是在互联网应用中，这种项目因为锁的存在会极大的降低性能。</p>
<h4 id="通过日志来进行业务补偿"><a href="#通过日志来进行业务补偿" class="headerlink" title="通过日志来进行业务补偿"></a>通过日志来进行业务补偿</h4><p>  事务日志：记录事务的开始，事务参于者，状态。保存在事物管理器<br>  undo/redolog：用于发生异常后为了实现最终一致性，进行重试( <strong>正想补充 redolog</strong> ) 或者回滚 （ <strong>反向补偿 undolog</strong> ）</p>
<h4 id="可靠消息传递"><a href="#可靠消息传递" class="headerlink" title="可靠消息传递"></a>可靠消息传递</h4><p>  防止在网路错误时候出现消息丢失情况，我们要实现，<strong>at least once</strong>：即消息可能投递多次</p>
<p>  主要幂等性：同一条数据执行多次后，结果不能发生改变。实现方案是采用排重表。【如：可能有多条插入数据库的消息，我们应该只能写入一条记录这种是幂等行，解决方案可能会采用一个排重列表，过滤掉重复的消息】</p>
<h4 id="无锁设计"><a href="#无锁设计" class="headerlink" title="无锁设计"></a>无锁设计</h4><p>  减少锁开销</p>
<ol>
<li>表面事务回滚，没有回滚则没有锁</li>
<li>通过辅助表取代热点数据的修改。如，秒杀系统的库存的预减</li>
<li>乐观锁</li>
</ol>
<h3 id="阿里的实践"><a href="#阿里的实践" class="headerlink" title="阿里的实践"></a>阿里的实践</h3><h4 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h4><p>具体叫rocketmq的实践，先发一个half-message给mq此时对消费者即远端事务透明，生产者完成本地事务提交给mq，mq在将事务发给消费者。</p>
<p>兜底策略：如果mq长期没有half-message的ack,mq会主动问询生产者状态，来确认事务是进一步进行还是丢弃。</p>
<p>缺点：仅适用于俩个参与者，仅能提供正向补偿。</p>
<h4 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h4><p>为了解决多参与者以及实现反向补偿（rollback），在支付宝场景下实现了TCC(try confirm cancel)</p>
<ul>
<li>try:对资源的检验、锁定，实现软隔离</li>
<li>confirm:事务的真正提交过程，只用try阶段锁定的资源。</li>
<li>cancel:取消回滚</li>
</ul>
<p>tcc只提供了框架，真正的资源回滚还需要业务方自己通过代码进行回滚。</p>
<h4 id="TXC"><a href="#TXC" class="headerlink" title="TXC"></a>TXC</h4><p>新一大分布式事务处理框架，他是通过在db层上实现了比较薄的代理来实现分布式事物。</p>
<ul>
<li>TXC用来开启(register)一个事务，分配一个txid</li>
<li>之后所有的对db的请求会先通过txc-rm这个代理，他负责解析sql语句如果遇到Insert/delete/update会生成undolog和redolog</li>
<li>自动回滚：当有回滚需求时候<ul>
<li>校验当前数据库的值和redolog是否一致，如果一致通过undolog回滚</li>
<li>如果不一致，说明别的进程和事务已经修改了数据库，这时候回滚可能会导致数据不一致，只能同构redolog进行重试补偿。</li>
</ul>
</li>
</ul>
<h3 id="缓存的使用"><a href="#缓存的使用" class="headerlink" title="缓存的使用"></a>缓存的使用</h3><p>  以大促为例，阿里采用自己开发的Tair作为缓存，我们可以使用redis的方案。</p>
<p>  以秒杀场景为例，看下缓存的作用：</p>
<p>  首先要做服务集群的隔离</p>
<h4 id="小库存的秒杀场景"><a href="#小库存的秒杀场景" class="headerlink" title="小库存的秒杀场景"></a>小库存的秒杀场景</h4><ol>
<li>商品详情页的缓存降低数据查询压力</li>
<li>库存校验的的条件判断：在下单前判断库存是否还足够</li>
<li>下单时候用乐观锁来修改库存</li>
</ol>
<h4 id="大库存热点商品的秒杀"><a href="#大库存热点商品的秒杀" class="headerlink" title="大库存热点商品的秒杀"></a>大库存热点商品的秒杀</h4><p>  这种情况不适合用乐观锁的原因是锁所冲突很大，并且会出现后下单的反而抢到了商品情况。</p>
<p>  我们这时候在下单时候，可以按照如下逻辑，注意括号中的备注</p>
<blockquote>
<p>预订单对用户不可见(用于缓存崩溃等情况恢复用的快照)–&gt;发送消息给mq（保证下订单的顺序）–&gt; 缓存中扣减库存（事务交给缓存）–&gt;修改订单状态，完单。</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/数据库拆分实现业务线性能力扩展/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/数据库拆分实现业务线性能力扩展/" class="post-title-link" itemprop="url">数据库拆分实现业务线性能力扩展</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-17 11:00:30" itemprop="dateCreated datePublished" datetime="2020-06-17T11:00:30Z">2020-06-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/" itemprop="url" rel="index"><span itemprop="name">读后感</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/企业IT架构转型之道/" itemprop="url" rel="index"><span itemprop="name">企业IT架构转型之道</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在业务达到一定规模后，由于数据库是中心架构的，一个设计糟糕的数据库将会给业务带来非常严重的灾难，这方面阿里提出了很多宝贵的经验和方法论。</p>
<h2 id="阿里数据库的分布式方案"><a href="#阿里数据库的分布式方案" class="headerlink" title="阿里数据库的分布式方案"></a>阿里数据库的分布式方案</h2><ol>
<li>垂直拆分：根据不同的业务以高内聚、低耦合的原则，将数据拆分到不同的数据库中</li>
<li>读写分离：垂直拆分后有些服务的请求量依然很大，我们首先想到的是读/写分离，因为往往业务场景决定这读远远大于写，这时候进行读写分离可以有效降低写的压力，且从库可以追加多个</li>
<li>分库分表：读写分离无法解决单表写的性能问题，以及单表数据量大的问题，针对这个问题我们可以采用水平分库/表的方案，根绝业务特点对表、库进行水平拆分，分表可以减小单表数据量，分库可以减少单库连接数的上线，从而满足业务的需求。</li>
</ol>
<p>阿里开发了TDDL，作为数据库的拆分方案，特点是：全面支持jdbc，对业务无侵入。</p>
<ol>
<li>matrix：根据业务配置分表规则针对sql语句进行解析，选择需要执行的groupDS</li>
<li>groupDS：负责读写分离，以及根据权重选择atomDS；</li>
<li>atomDs:持有数据库的原子链接；</li>
</ol>
<h2 id="数据库分表的原则"><a href="#数据库分表的原则" class="headerlink" title="数据库分表的原则"></a>数据库分表的原则</h2><ol>
<li>数据尽量均匀：防止数据倾斜；</li>
<li>减少事务边界：尽量减少违反分表分库规则的事务，否则需要进行全表扫描，因为需要在内存中进行聚合，就会降低系统性能，且系统的性能指标就降为单库的指标。</li>
<li>异构索引表来满足跨表查询的场景；</li>
<li><p>提供其他搜索方案来解决复杂的查询、搜索场景；</p>
<p>其中异构索引表，大部分小企业可以采用业务来解决，阿里提供了精卫系统在系统层面来解决数据同步需求：</p>
</li>
<li><p>原理是消费binlog，通过配置进行过滤，同步；</p>
</li>
<li>支持多线程同时同步，为了保证数据在并发情况的一致性，同一条语句根据规则打到同一个线程执行；</li>
<li>强大的UI工具支持；</li>
<li><p>数据的安全性：</p>
<ol>
<li>采用zookeeper做调度、管控；</li>
<li>手动主从切换、宕机回复；</li>
</ol>
<p>PS：</p>
<p>数据库分表分数据遇到了”数据均匀”，”减少事务边界”这两种情况冲突的情况，应该优先解决数据均匀的问题，因为减少事务边界可以采用异构索引表的方式解决。</p>
<p>实际开发中我们采用82原则，针对80%的情况下有20%的场景出现没有分表字段的情况，采用异构索引的方式处理，其他小概率的查询我们可以全表扫描等方案。</p>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/共享中心建设原则/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/共享中心建设原则/" class="post-title-link" itemprop="url">共享中心建设原则</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-16 23:35:46" itemprop="dateCreated datePublished" datetime="2020-06-16T23:35:46Z">2020-06-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/" itemprop="url" rel="index"><span itemprop="name">读后感</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/企业IT架构转型之道/" itemprop="url" rel="index"><span itemprop="name">企业IT架构转型之道</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>中台不是一成不变的要能跟这业务一起成长，提供多样的接口，作为业务的沉淀</p>
<h2 id="共享服务考量指标"><a href="#共享服务考量指标" class="headerlink" title="共享服务考量指标"></a>共享服务考量指标</h2><ul>
<li>设计：遵循面向对象的原则<br>运营：中台要切实能够解决业务问题，业务能够运营</li>
<li><ul>
<li>工程：在做拆分时候要考虑投入的成本</li>
</ul>
</li>
</ul>
<h2 id="建设中台的几个原则"><a href="#建设中台的几个原则" class="headerlink" title="建设中台的几个原则"></a>建设中台的几个原则</h2><ol>
<li>高内聚，低耦合</li>
<li>数据完整性</li>
<li>业务可运营性</li>
<li>循序渐进</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/中台演进之路/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/中台演进之路/" class="post-title-link" itemprop="url">中台演进之路</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-15 22:56:43" itemprop="dateCreated datePublished" datetime="2020-06-15T22:56:43Z">2020-06-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/" itemprop="url" rel="index"><span itemprop="name">读后感</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/企业IT架构转型之道/" itemprop="url" rel="index"><span itemprop="name">企业IT架构转型之道</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>与大部分企业的服务化的演进之路如初一辙</p>
<h2 id="单体应用阶段"><a href="#单体应用阶段" class="headerlink" title="单体应用阶段"></a>单体应用阶段</h2><p>单体应用，所有的服务跑在一个war包中，这个war包200多MB。之后遇到了如下的问题</p>
<ol>
<li>数据库的链接到了瓶颈：因为所有的程序在一个war包中，这个工程的数据库连接池非常大，已经逼近了单机数据库的连接池的上限；</li>
<li>所有功能耦合在一起：牵一发而懂全身，很可能一个小改动就引起宕机;</li>
<li>性能问题：没法做业务的隔离，一个接口慢，会拖垮整个项目</li>
<li>业务膨胀导致没有一个人能了解所有的代码，祖传代码盛行。</li>
</ol>
<h2 id="服务化"><a href="#服务化" class="headerlink" title="服务化"></a>服务化</h2><p>飞行中换发动机，采用去中心化的分布式架构逐步用服务替换掉单体应用。</p>
<h3 id="淘宝的微服务化"><a href="#淘宝的微服务化" class="headerlink" title="淘宝的微服务化"></a>淘宝的微服务化</h3><p>  淘宝采用去中心化的微服务架构。与之相对的是中心化架构，著名的“ESB”架构，这个架构有个致命的问题，ESB作为真个架构的路由，所有的服务都会落在ESB上，那么他就会成为整个系统的瓶颈，维护成本很高，并且会制约业务发展。这些是互联网业务无法容忍的，所以淘宝就采用了HSF这种去中心化的分布式架构，服务直接点对点的直接调用。（它的特点naming服务只做服务发现、订阅和配置更新的推送，在服务之间大量的请求并没有走naming）。</p>
<p>  这种架构也就是现在的微服务架构，因为它：</p>
<ol>
<li>以服务方式提供应用</li>
<li>以服务的方式而非项目的方式组织架构</li>
<li>通过服务的只能编排提供业务支撑</li>
<li><p>智能运维，以及健壮的平台稳定性（降级、限流、熔断）</p>
<p>当然微服务话我们也要接受如下挑战：</p>
</li>
<li><p>服务的管控：服务的配置中心，服务的全链路跟踪等需要支持否则排错，自我运维闭环是无法实现的；</p>
</li>
<li>分布式事务的支持：与单体不同，对于数据一致性要求高的场景我们要想办法支持分布式事务的场景;</li>
<li>只能运维的支持以及平台稳定性挑战;</li>
<li>组织架构的变化：要根据服务特点组织组织架构的变化;</li>
</ol>
<h2 id="演进史"><a href="#演进史" class="headerlink" title="演进史"></a>演进史</h2><p>建立共享服务中心，前期根据业务拆分了4个中心用户中心，商品中心，交易中心，店铺中心。</p>
<h3 id="用户中心"><a href="#用户中心" class="headerlink" title="用户中心"></a>用户中心</h3><p>改造成本低相较于其他模块功能简单，受益巨大上游调用次数多，所以是很好的🕙。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/为什么要构建中台/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/为什么要构建中台/" class="post-title-link" itemprop="url">为什么要构建中台</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-10 23:33:18" itemprop="dateCreated datePublished" datetime="2020-06-10T23:33:18Z">2020-06-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/" itemprop="url" rel="index"><span itemprop="name">读后感</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读后感/企业IT架构转型之道/" itemprop="url" rel="index"><span itemprop="name">企业IT架构转型之道</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="为什么要有中台"><a href="#为什么要有中台" class="headerlink" title="为什么要有中台"></a>为什么要有中台</h2><p>  由于企业的业务不断发展，出现很多功能重复的系统，导致整个技术部门烟囱临立的情况。</p>
<p>  <strong>烟囱的危害具体有</strong></p>
<ul>
<li>功能重复导致资源浪费，道理不说了。</li>
<li>打通不同系统的成本很高，不同的系统，数据、业务都是独立的，想打通需要耗费很大的精力，并且之后的修改很有可能牵一发而动全身。</li>
<li>由于数据、业务分散在不同的系统中，这种无法收敛的状态也不利于公司的技术、业务沉淀，比如：随着业务的发展，A业务原有的系统无法满足，如果没有中台那么A就很有可能在开发一套新的系统，抛弃原有的系统。如果有中台就可以通过中台不断迭代，甚至有可能复用给其他的业务。</li>
</ul>
<p><strong>搭建一个合格的中台的条件</strong></p>
<ul>
<li>首先，来自于企业和团队的决心，耐心。我们都知道阿里巴巴的中台策略很出名，原因在于整个集团对于共享服务的态度，要求业务部门必须接入共享服务中心，哪怕初期功能在简陋、在粗糙，否则搭建的中台就是另一个又昂贵，又脱离业务的新烟囱。</li>
<li>其次，中台的开发者要深入到业务当中，对现有的不同部门、团队的业务进行抽象提取共性，以服务重用的目标来建立、思考中台，而不是简单的将服务打通，堆积在一起。</li>
<li>再次，中台的开发者要有长期迭代的心态，不是上线这个项目或者这个服务就完了。上线这个项目才仅仅是迈出这个中台服务的第一步。后续的迭代成长才是关键。</li>
</ul>
<p><strong>搭建中台的具体好处</strong></p>
<ul>
<li>便于业务的创新：每个业务都只是从自己业务的角度看待问题，但是如果从中台的角度看待问题，横跨多个业务，在整合的过程中可能碰撞出新的想法。</li>
<li>快速迭代、业务试错：supercell和阿里巴巴的大中台小前台策略，可以保证在最小的资源投入前提下进行快速的试错。</li>
<li>数据打通：真正体现大数据的威力，并且懂业务的人才：因为如果还是传统项目制度，研发只会关注现有功能开发和维护，而不会从业务方面思考问题，通过构建中台，研发更加贴近业务会去思考技术如何更好的为业务服务。</li>
<li>改变组织形式提高效能：从自上而下的流失组织架构，改为以共享服务为中心的小团队协作。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/系统优化-方法论-分析问题的套路总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/系统优化-方法论-分析问题的套路总结/" class="post-title-link" itemprop="url">系统优化-方法论-分析问题的套路总结</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-07 19:44:52" itemprop="dateCreated datePublished" datetime="2020-06-07T19:44:52Z">2020-06-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机基础/" itemprop="url" rel="index"><span itemprop="name">计算机基础</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机基础/方法论/" itemprop="url" rel="index"><span itemprop="name">方法论</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="系统资源瓶颈"><a href="#系统资源瓶颈" class="headerlink" title="系统资源瓶颈"></a>系统资源瓶颈</h2><h3 id="CPU-性能分析"><a href="#CPU-性能分析" class="headerlink" title="CPU 性能分析"></a>CPU 性能分析</h3><p><img src="/系统优化-方法论-分析问题的套路总结/cpu.png" alt="avator"></p>
<h4 id="CPU优化思路"><a href="#CPU优化思路" class="headerlink" title="CPU优化思路"></a>CPU优化思路</h4><p>从这几个方面出发，我相信你已经想到了很多的优化方法。这里，我主要强调一下，最典型的三种优化方法。</p>
<ol>
<li>把进程绑定到一个或者多个 CPU 上，充分利用 CPU 缓存的本地性，并减少进程间的相互影响。</li>
<li>为中断处理程序开启多 CPU 负载均衡，以便在发生大量中断时，可以充分利用多 CPU 的优势分摊负载。</li>
<li>使用 Cgroups 等方法，为进程设置资源限制，避免个别进程消耗过多的 CPU。同时，为核心应用程序设置更高的优先级，减少低优先级任务的影响。</li>
</ol>
<h3 id="内存-性能分析"><a href="#内存-性能分析" class="headerlink" title="内存 性能分析"></a>内存 性能分析</h3><p><img src="/系统优化-方法论-分析问题的套路总结/mem.png" alt="avator"></p>
<h4 id="内存优化思路"><a href="#内存优化思路" class="headerlink" title="内存优化思路"></a>内存优化思路</h4><ol>
<li>除非有必要，Swap 应该禁止掉。这样就可以避免 Swap 的额外 I/O ，带来内存访问变慢的问题。</li>
<li>使用 Cgroups 等方法，为进程设置内存限制。这样就可以避免个别进程消耗过多内存，而影响了其他进程。对于核心应用，还应该降低 oom_score，避免被 OOM 杀死。</li>
<li>使用大页、内存池等方法，减少内存的动态分配，从而减少缺页异常。</li>
</ol>
<h3 id="磁盘IO-性能分析"><a href="#磁盘IO-性能分析" class="headerlink" title="磁盘IO 性能分析"></a>磁盘IO 性能分析</h3><p><img src="/系统优化-方法论-分析问题的套路总结/io.png" alt="avator"></p>
<h4 id="磁盘IO-优化思路"><a href="#磁盘IO-优化思路" class="headerlink" title="磁盘IO 优化思路"></a>磁盘IO 优化思路</h4><ol>
<li>也是最简单的方法，通过 SSD 替代 HDD、或者使用 RAID 等方法，提升 I/O 性能。</li>
<li>针对磁盘和应用程序 I/O 模式的特征，选择最适合的 I/O 调度算法。比如，SSD 和虚拟机中的磁盘，通常用的是 noop 调度算法；而数据库应用，更推荐使用 deadline 算法。</li>
<li>优化文件系统和磁盘的缓存、缓冲区，比如优化脏页的刷新频率、脏页限额，以及内核回收目录项缓存和索引节点缓存的倾向等等</li>
</ol>
<h3 id="网络-性能分析"><a href="#网络-性能分析" class="headerlink" title="网络 性能分析"></a>网络 性能分析</h3><p><img src="/系统优化-方法论-分析问题的套路总结/nat.png" alt="avator"></p>
<p>而要分析网络的性能，自然也是要从这几个协议层入手，通过使用率、饱和度以及错误数这几类性能指标，观察是否存在性能问题。比如 ：</p>
<ul>
<li>在链路层，可以从网络接口的吞吐量、丢包、错误以及软中断和网络功能卸载等角度分析；</li>
<li>在网络层，可以从路由、分片、叠加网络等角度进行分析；</li>
<li>在传输层，可以从 TCP、UDP 的协议原理出发，从连接数、吞吐量、延迟、重传等角度进行分析；</li>
<li>在应用层，可以从应用层协议（如 HTTP 和 DNS）、请求数（QPS）、套接字缓存等角度进行分析。</li>
</ul>
<h4 id="网络-优化思路"><a href="#网络-优化思路" class="headerlink" title="网络 优化思路"></a>网络 优化思路</h4><ol>
<li>你可以增大套接字缓冲区、连接跟踪表、最大半连接数、最大文件描述符数、本地端口范围等内核资源配额；</li>
<li>也可以减少 TIMEOUT 超时时间、SYN+ACK 重传数、Keepalive 探测时间等异常处理参数；</li>
<li>还可以开启端口复用、反向地址校验，并调整 MTU 大小等降低内核的负担。</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liuhao163.github.io/系统优化-方法论-如何建立监控体系/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liu hao">
      <meta itemprop="description" content="励志当好厨子的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhao163.github.io">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/系统优化-方法论-如何建立监控体系/" class="post-title-link" itemprop="url">系统优化-方法论-如何建立监控体系</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-07 19:04:42" itemprop="dateCreated datePublished" datetime="2020-06-07T19:04:42Z">2020-06-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-09-21 15:03:02" itemprop="dateModified" datetime="2022-09-21T15:03:02Z">2022-09-21</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机基础/" itemprop="url" rel="index"><span itemprop="name">计算机基础</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机基础/方法论/" itemprop="url" rel="index"><span itemprop="name">方法论</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们如何建立有效的监控体系？我们可以从俩个维度来看，系统指标，应用指标。</p>
<h2 id="系统指标"><a href="#系统指标" class="headerlink" title="系统指标"></a>系统指标</h2><p>在开始监控系统之前，你肯定最想知道，怎么才能用简洁的方法，来描述系统资源的使用情况。不过不要忘记，每种资源的性能指标可都有很多，使用过多指标本身耗时耗力不说，也不容易为你建立起系统整体的运行状况。在这里，我为你介绍一种专门用于性能监控的 USE（Utilization Saturation and Errors）法。USE 法把系统资源的性能指标，简化成了三个类别，即使用率、饱和度以及错误数。</p>
<ul>
<li>使用率，表示资源用于服务的时间或容量百分比。100% 的使用率，表示容量已经用尽或者全部时间都用于服务。</li>
<li>饱和度，表示资源的繁忙程度，通常与等待队列的长度相关。100% 的饱和度，表示资源无法接受更多的请求。</li>
<li>错误数表示发生错误的事件个数。错误数越多，表明系统的问题越严重。</li>
</ul>
<p><img src="/系统优化-方法论-如何建立监控体系/use.png" alt="avator"></p>
<p>工具有:zabix，Prometheus等</p>
<p><img src="/系统优化-方法论-如何建立监控体系/prometheus.png" alt="avator"></p>
<h2 id="应用指标"><a href="#应用指标" class="headerlink" title="应用指标"></a>应用指标</h2><p>应用指标可以直观的反应出服务的运行状况，我们更关注，请求数，延迟，错误率等，分布式系统、微服务还需要把握整个请求链路。</p>
<ul>
<li>全链路分析：掌握整个请求链路的响应时间、成功率，有zipkin,还有各大公司的trace方案</li>
<li>指标分析：还需要对重点的业务，逻辑字日志中大点进行监控，解决方案可以采用：elk或者efk。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Liu hao</p>
              <p class="site-description motion-element" itemprop="description">励志当好厨子的程序员</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">222</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">54</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">81</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/liuhao163" title="GitHub &rarr; https://github.com/liuhao163" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:liu67224657@qq.com" title="E-Mail &rarr; mailto:liu67224657@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu hao</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>


  
  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
